#!/bin/bash
# pullins - pull & install
# Last Edit: 27.05.2012

# read configuration and functions
source /etc/nsc-tools/nsc-client.conf
source /etc/nsc-tools/functions


# preliminary checks
if [ "$UID" != "0" ]; then
	echo "You need to be root to use this program! Exiting..."
	exit 1
fi

if [ $# -eq 0 ]; then
    echo "You should pass the names of some packages you want to install! Exiting..."
    exit 2
fi

# handle SIGINT
trap cleanup INT

# download the packages on the server side
echo "Action on the remote server"
ssh $REPO_USER@$REPO_IP /home/$REPO_USER/download-pkgs "$@"

# mount the NFS share on our side and install the packages
echo "Actions taking place on this machine" &&
mount_share &&
echo "Installing..." &&
pacman --dbpath "$MOUNTPOINT/db" --cachedir "$MOUNTPOINT/cache" -S "$@"

push_pkglist_if_neccessary

cleanup
